### Работа с join'ами, статистикой 

*Цель:*
*знать и уметь применять различные виды join'ов*
*строить и анализировать план выполенения запроса*
*оптимизировать запрос*
*уметь собирать и анализировать статистику для таблицы*


### Решение:    

### 1. Реализовать прямое соединение двух таблиц  

Ставим бд demo  

![image](https://github.com/13-rus/Otus/assets/120638894/2bb11eba-25ef-43f2-86f6-da58609b6dcd)  

 Берем две таблицы из нашей demo базы установленной ранее.  
   
![image](https://github.com/13-rus/Otus/assets/120638894/1c853445-601b-45a1-a8d0-f3937ffeb172)  

и  

![image](https://github.com/13-rus/Otus/assets/120638894/b55cf510-e92f-48ac-bb41-8c4d4d73f8a3)  

Объединяем их  

![image](https://github.com/13-rus/Otus/assets/120638894/181000f2-03cd-4977-88ca-d0edb2d662f4)  

смотрим результат запроса как он выполняется    

![image](https://github.com/13-rus/Otus/assets/120638894/78e9c9fb-136c-4e91-8da4-e575336d724a)  

сначала идет последовательное сканирование таблицы и реализует hash  
далее вторую таблицу последовательно сканирует, опять делает hash  
И потом уже сравнивает значения hash join  
Т.е. он сканирует обе таблицы seq scan, т.к. нет никакого условия и потом возвращает и реализует hash join  
строит хеш функцию и сравнивает таблицу одну с другим значением.  


далее пробуем с условием выполнить  

![image](https://github.com/13-rus/Otus/assets/120638894/2bbe4fcd-f13f-4edf-9d15-e635591f6021)  

Тут мы видим, что используется Nested loop  
Простой перебор по условию, т.к. маленький набор данных получается   


и потом еще отсортируем его  

![image](https://github.com/13-rus/Otus/assets/120638894/7641c7da-e63d-42c9-9d36-19d9d92f4ec2)  

Используется index scan сортирует по индексу обе таблицы.  
Таблицы отсортированы и он берет merge join  
т.к. данные уже отсортированы и может выиграть время.  


### 2. Реализуем левостороннее соединение двух таблиц  
![image](https://github.com/13-rus/Otus/assets/120638894/0c19071f-d96f-4ef7-9dda-b86634a13f71)  

///  
![image](https://github.com/13-rus/Otus/assets/120638894/af690a18-1133-41f2-8001-9ef30efd20ff)  

смотримм....  
с условием делаем  
![image](https://github.com/13-rus/Otus/assets/120638894/f25de9e3-3053-438d-b03c-2e84eb3fbe06)  

...  


### 3. Реализовать кросс соединение двух таблиц  
![image](https://github.com/13-rus/Otus/assets/120638894/3ab1d6ab-51b5-4d37-af5c-b4231d7bdc9f)  

...
![image](https://github.com/13-rus/Otus/assets/120638894/95f20153-25f0-489e-892b-9722c30fc748)



### 4. Реализовать полное соединение двух или более таблиц  

![image](https://github.com/13-rus/Otus/assets/120638894/1a19c1e8-0689-4b67-adca-ac9496c73829)  

![image](https://github.com/13-rus/Otus/assets/120638894/0ae8a8c2-6ff9-462b-8c89-fc90450ea440)  

Реализовать запрос, в котором будут использован join и подзапрос  

![image](https://github.com/13-rus/Otus/assets/120638894/9179ca05-3998-486b-9c01-b05835b88a59)  


К работе приложить структуру таблиц, для которых  
![image](https://github.com/13-rus/Otus/assets/120638894/5196d5a5-ae39-4d56-accd-ce4175768fce)


выполнялись соединения
